/**
 * @fileOverview \u5207\u6362\u6807\u7b7e\u5165\u53e3
 * @ignore
 */define("bui/tab",["bui/common","bui/tab/tab","bui/tab/tabitem","bui/tab/navtabitem","bui/tab/navtab","bui/tab/tabpanel","bui/tab/tabpanelitem"],function(e){var t=e("bui/common"),n=t.namespace("Tab");return t.mix(n,{Tab:e("bui/tab/tab"),TabItem:e("bui/tab/tabitem"),NavTabItem:e("bui/tab/navtabitem"),NavTab:e("bui/tab/navtab"),TabPanel:e("bui/tab/tabpanel"),TabPanelItem:e("bui/tab/tabpanelitem")}),n}),define("bui/tab/navtabitem",["bui/common"],function(e){var t=e("bui/common"),n=t.Component,r="tab-item-title",i="tab-item-close",s="tab-nav-actived",o="tab-content",u=n.View.extend({renderUI:function(){var e=this,t=e.get("tabContentContainer"),n=e.get("tabContentTpl");if(t){var r=$(n).appendTo(t);e.set("tabContentEl",r)}},_uiSetHref:function(e){this._setHref(e)},_setHref:function(e){var t=this,n=t.get("tabContentEl");e=e||t.get("href"),n&&$("iframe",n).attr("src",e)},resetHref:function(){this._setHref()},_uiSetTitle:function(e){var t=this,n=t.get("el");n.attr("title",e),$("."+r,n).text(e)},_uiSetActived:function(e){var t=this,n=t.get("el");t.setTabContentVisible(e),e?n.addClass(s):n.removeClass(s)},destructor:function(){var e=this,t=e.get("tabContentEl");t&&t.remove()},setTabContentVisible:function(e){var t=this,n=t.get("tabContentEl");n&&(e?n.show():n.hide())}},{ATTRS:{tabContentContainer:{},tabContentEl:{},title:{},href:{}}}),a=n.Controller.extend({createDom:function(){var e=this,t=e.get("parent");t&&e.set("tabContentContainer",t.getTabContentContainer())},bindUI:function(){var e=this,t=e.get("el"),n=e.get("events");t.on("click",function(t){var n=$(t.target);n.hasClass(i)&&e.fire("closing")!==!1&&e.close()})},handleDblClick:function(e){var t=this;t.fire("closing")!==!1&&t.close(),t.fire("dblclick",{domTarget:e.target,domEvent:e})},handleContextMenu:function(e){e.preventDefault(),this.fire("showmenu",{position:{x:e.pageX,y:e.pageY}})},setTitle:function(e){this.set("title",e)},close:function(){this.fire("closed")},reload:function(){this.get("view").resetHref()},show:function(){var e=this;e.get("el").show(500,function(){e.set("visible",!0)})},hide:function(e){var t=this;this.get("el").hide(500,function(){t.set("visible",!1),e&&e()})},_uiSetActived:function(e){var t=this,n=t.get("parent");n&&e&&n._setItemActived(t)},_uiSetCloseable:function(e){var t=this,n=t.get("el"),r=n.find("."+i);e?r.show():r.hide()}},{ATTRS:{elTagName:{value:"li"},actived:{view:!0,value:!1},closeable:{value:!0},allowTextSelection:{view:!1,value:!1},events:{value:{click:!0,closing:!0,closed:!0,showmenu:!0,afterVisibleChange:!0}},tabContentContainer:{view:!0},tabContentTpl:{view:!0,value:'<div class="'+o+'" style="display:none;"><iframe src="" width="100%" height="100%" frameborder="0"></iframe></div>'},href:{view:!0,value:""},visible:{view:!0,value:!0},title:{view:!0,value:""},tpl:{view:!0,value:'<span class="'+r+'"></span><s class="'+i+'"></s>'},xview:{value:u}}},{xclass:"nav-tab-item",priority:0});return a.View=u,a}),define("bui/tab/navtab",["bui/common","bui/menu"],function(e){var t=e("bui/common"),n=e("bui/menu"),r=t.Component,i="tab-nav-list",s="arrow-left",o="arrow-right",u="m_close",a=140,f=r.View.extend({renderUI:function(){var e=this,t=e.get("el"),n=null;n=t.find("."+i),e.setInternal("listEl",n)},getContentElement:function(){return this.get("listEl")},getTabContentContainer:function(){return this.get("el").find(".tab-content-container")},_uiSetHeight:function(e){var t=this,n=t.get("el"),r=n.find(".tab-nav-bar"),i=t.getTabContentContainer();e&&i.height(e-r.height()),n.height(e)}},{},{xclass:"nav-tab-view",priority:0}),l=r.Controller.extend({addTab:function(e,n){var r=this,i=e.id||t.guid("tab-item"),s=r.getItemById(i);if(s){var o=!1;e.href&&s.get("href")!=e.href&&(s.set("href",e.href),o=!0),r._setItemActived(s),n&&!o&&s.reload()}else e=t.mix({id:i,visible:!1,actived:!0,xclass:"nav-tab-item"},e),s=r.addChild(e),s.show(),r._resetItemList();return s},getTabContentContainer:function(){return this.get("view").getTabContentContainer()},bindUI:function(){var e=this;e._bindScrollEvent(),e.on("click",function(t){var n=t.target;n!=e&&(e._setItemActived(n),e.fire("itemclick",{item:n}))}),e.on("closed",function(t){var n=t.target;e._closeItem(n)}),e.on("showmenu",function(t){e._showMenu(t.target,t.position)}),e.on("afterVisibleChange",function(t){var n=t.target;n.get("actived")&&e._scrollToItem(n)})},_bindScrollEvent:function(){var e=this,t=e.get("el");t.find(".arrow-left").on("click",function(){t.hasClass(s+"-active")&&e._scrollLeft()}),t.find(".arrow-right").on("click",function(){t.hasClass(o+"-active")&&e._scrllRight()})},_showMenu:function(e,t){var n=this,r=n._getMenu(),i=e.get("closeable"),s;n.set("showMenuItem",e),r.set("xy",[t.x,t.y]),r.show(),s=r.getItem(u),s&&s.set("disabled",!i)},setActived:function(e){var t=this,n=t.getItemById(e);t._setItemActived(n)},getActivedItem:function(){var e=this,n=e.get("children"),r=null;return t.each(n,function(e){if(e.get("actived"))return r=e,!1}),r},getItemById:function(e){var n=this,r=n.get("children"),i=null;return t.each(r,function(t){if(t.get("id")===e)return i=t,!1}),i},_getMenu:function(){var e=this;return e.get("menu")||e._initMenu()},_initMenu:function(){var e=this,t=new n.ContextMenu({children:[{xclass:"context-menu-item",iconCls:"icon icon-refresh",text:"\u5237\u65b0",listeners:{click:function(){var t=e.get("showMenuItem");t&&t.reload()}}},{id:u,xclass:"context-menu-item",iconCls:"icon icon-remove",text:"\u5173\u95ed",listeners:{click:function(){var t=e.get("showMenuItem");t&&t.close()}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u5176\u4ed6",listeners:{click:function(){var t=e.get("showMenuItem");t&&e.closeOther(t)}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u6240\u6709",listeners:{click:function(){e.closeAll()}}}]});return e.set("menu",t),t},_closeItem:function(e){var t=this,n=t._getIndex(e),r=t.getActivedItem(),i=t._getItemByIndex(n-1),s=t._getItemByIndex(n+1);e.hide(function(){t.removeChild(e,!0),t._resetItemList(),r===e?i?t._setItemActived(i):t._setItemActived(s):t._scrollToItem(r)})},closeAll:function(){var e=this,n=e.get("children");t.each(n,function(e){e.close()})},closeOther:function(e){var n=this,r=n.get("children");t.each(r,function(t){e!==t&&t.close()})},_getItemByIndex:function(e){var t=this,n=t.get("children");return n[e]},_getIndex:function(e){var n=this,r=n.get("children");return t.Array.indexOf(e,r)},_resetItemList:function(){var e=this,t=e.get("children"),n=e.getContentElement(),r=t.length*a;n.width(r)},_scrollToItem:function(e){var t=this,n=t.getContentElement(),r=n.position(),i=t._getDistanceToEnd(e,n,r),s=t._getDistanceToBegin(e,r);if(n.width()<n.parent().width())t._scrollTo(n,0);else if(s<0)t._scrollTo(n,r.left-s);else if(i>0)t._scrollTo(n,r.left+i*-1);else if(r.left<0){var o=t._getLastDistance(n,r),u=0;o<0&&(u=r.left-o,u=u<0?u:0,t._scrollTo(n,u))}},_getDistanceToBegin:function(e,t){var n=e.get("el").position();return n.left+t.left},_getDistanceToEnd:function(e,t,n){var r=this,t=t||r.getContentElement(),i=t.parent().width(),n=n||t.position(),s=r._getDistanceToBegin(e,n),o=s+a-i;return o},_getLastDistance:function(e,t){var n=this,r=n.get("children"),i=r[r.length-1];return i?n._getDistanceToEnd(i,e,t):0},_scrollTo:function(e,t,n){var r=this;e.animate({left:t},500,function(){r._setArrowStatus(e)})},_scrollLeft:function(){var e=this,t=e.getContentElement(),n=t.position(),r=e._getLastDistance(t,n),i;r>0&&(i=r>a?a:r,e._scrollTo(t,n.left-i))},_scrllRight:function(){var e=this,t=e.getContentElement(),n=t.position(),r;n.left<0&&(r=n.left+a,r=r<0?r:0,e._scrollTo(t,r))},_setArrowStatus:function(e,t){e=e||this.getContentElement();var n=this,r=n.get("el"),i=t||e.position(),u=n._getLastDistance(e,t);i.left<0?r.addClass(o+"-active"):r.removeClass(o+"-active"),u>0?r.addClass(s+"-active"):r.removeClass(s+"-active")},_setItemActived:function(e){var t=this,n=t.getActivedItem();if(e===n)return;n&&n.set("actived",!1),e&&(e.get("actived")||e.set("actived",!0),e.get("visible")&&t._scrollToItem(e),t.fire("activeChange",{item:e}))}},{ATTRS:{defaultChildClass:{value:"nav-tab-item"},menu:{},tpl:{view:!0,value:'<div class="tab-nav-bar"><s class="tab-nav-arrow arrow-left"></s><div class="tab-nav-wrapper"><div class="tab-nav-inner"><ul class="'+i+'"></ul></div></div><s class="tab-nav-arrow arrow-right"></s>'+"</div>"+'<div class="tab-content-container"></div>'},xview:{value:f},events:{value:{itemclick:!1}}}},{xclass:"nav-tab",priority:0});return l}),define("bui/tab/tabitem",["bui/common"],function(e){var t=e("bui/common"),n=t.Component,r=n.UIBase,i=n.View.extend([r.ListItemView],{},{xclass:"tab-item-view"}),s=n.Controller.extend([r.ListItem],{},{ATTRS:{elTagName:{view:!0,value:"li"},xview:{value:i},tpl:{view:!0,value:'<span class="bui-tab-item-text">{text}</span>'}}},{xclass:"tab-item"});return s.View=i,s}),define("bui/tab/tab",["bui/common"],function(e){var t=e("bui/common"),n=t.Component,r=n.UIBase,i=n.Controller.extend([r.ChildList],{},{ATTRS:{elTagName:{view:!0,value:"ul"},defaultChildClass:{value:"tab-item"}}},{xclass:"tab"});return i}),define("bui/tab/tabpanelitem",["bui/common","bui/tab/tabitem"],function(e){var t=e("bui/common"),n=e("bui/tab/tabitem"),r=t.Component,i=n.View.extend({},{xclass:"tab-panel-item-view"}),s=n.extend({renderUI:function(){var e=this,t=e.get("selected");e._setPanelVisible(t)},_setPanelVisible:function(e){var t=this,n=t.get("panel"),r=e?"show":"hide";n&&$(n)[r]()},_uiSetSelected:function(e){this._setPanelVisible(e)},destructor:function(){var e=this,t=e.get("panel");t&&e.get("panelDestroyable")&&$(t).remove()}},{ATTRS:{panel:{},panelDestroyable:{value:!0},xview:{value:i}}},{xclass:"tab-panel-item"});return s.View=i,s}),define("bui/tab/tabpanel",["bui/common","bui/tab/tab"],function(e){var t=e("bui/common"),n=e("bui/tab/tab"),r=n.extend({initializer:function(){var e=this,n=e.get("children"),r=$(e.get("panelContainer")),i=e.get("panelCls"),s=i?r.find("."+s):r.children();t.each(n,function(e,t){e.set?e.set("panel",s[t]):e.panel=s[t]})}},{ATTRS:{defaultChildClass:{value:"tab-panel-item"},panelContainer:{},panelCls:{}}},{xclass:"tab-panel"});return r});
