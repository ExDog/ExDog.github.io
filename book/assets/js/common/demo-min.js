define("common/demo",["bui/common","bui/toolbar","bui/overlay"],function(c){var f=c("bui/common"),e=c("bui/toolbar"),b=c("bui/overlay"),a=b.Dialog;function g(){var h=this;if(!d.dialog){d.dialog=new a({title:"Demo",elCls:"demo-dialog",width:800,height:500})}return d.dialog}var d=f.Component.Controller.extend({renderUI:function(){var h=this,i=h.get("tpl"),j=h.get("el"),k=h.get("tbar");$(i).appendTo(j);k.render=h.get("el").find(".panel-header");k=new e.Bar(k);k.render();h.set("tbar",k)},bindUI:function(){var h=this,i=h.get("tbar");i.on("click",function(l){var k=l.target,j=k.get("type");if(j=="run"){h.run()}else{if(j=="source"){h.showSource()}}})},fetchSource:function(){var h=this,j=h.get("redirectUrl"),i=h.get("url");$.ajax({dataType:"jsonp",url:j,data:{file:i},success:function(k){h.set("source",k)},error:function(m,k,l){}})},run:function(){var h=this,j=h.get("dialog"),k=h.get("runTpl"),i=h.get("url");k=f.substitute(k,{src:i});j.set("bodyContent",k);j.show()},showScriptCode:function(){var h=this,j=h.get("el"),k=h.getScriptCode(),i=j.find(".panel-body");k=k.replace(/\\/ig,"<br/>");i.html(k);if(window.prettyPrintEl){prettyPrintEl(i[0])}},getScriptCode:function(l){var h=this,j=h.get("beginTag"),k=h.get("endTag"),i;l=l||h.get("source");i=l.indexOf(j);l=l.substring(i+j.length);i=l.lastIndexOf(k);if(i!==-1){l=l.substring(0,i)}return l},showSource:function(){var h=this,l=h.get("source"),k=h.get("dialog"),j=h.get("sourceTpl"),i=$(j);k.set("bodyContent",i);i.html(l);k.show()},_uiSetSource:function(i){var h=this;h.showScriptCode(i)}},{_dialog:null,ATTRS:{redirectUrl:{value:"http://www.builive.com/fetchdemo.php"},dialog:{getter:function(){return g()}},beginTag:{value:"&lt;!-- script start--&gt;  \n"},endTag:{value:"&lt;!-- script end --&gt;"},sourceTpl:{value:"<textarea></textarea>"},runTpl:{value:'<iframe width="100%" height="100%" src="{src}" frameborder="0"></iframe>'},source:{},url:{},tbar:{value:{elCls:"button-group pull-right",defaultChildCfg:{elCls:"button button-small"},children:[{content:"\u8fd0\u884c",type:"run"},{content:"\u6e90\u7801",type:"source"}]}},tpl:{value:'<div class="panel"><div class="panel-header">\u4ee3\u7801\u793a\u4f8b</div><pre class="panel-body"></pre></div>'}}},{xclass:"demo"});return d});
