define("common/page",["bui/common","common/link","bui/menu","common/demo","common/api"],function(d){var h=d("bui/common"),c=d("common/link"),g=d("bui/menu"),f=d("common/demo"),b=d("common/api"),a="prettyprint linenums";var e=function(i){e.superclass.constructor.call(this,i)};e.ATTRS={linkCls:{},api:{value:".J_API"},demoCls:{value:"page-demo"},demos:{value:[]}};h.extend(e,h.Base);h.augment(e,{init:function(){this._initDom();this._initEvent()},_initDom:function(){this._initLinks();this._initDemos();this._initNavMenu();this._initPretty();this._initAPI()},_initAPI:function(){if(!this._isHasAPI()){return}var i=this,k=[],j=$(i.get("api"));h.each(j,function(n){var l=this,m=new b({srcNode:n});m.render();k.push(m)});i.set("apis",k)},_isHasAPI:function(){return $(this.get("api")).length},_initDemos:function(){var j=this,i=j.get("demos"),k=j.get("demoCls");$("."+k).each(function(l,m){var n=new f({srcNode:m});i.push(n)});if(i.length){j._renderDemos(i)}},_getUnloadDemos:function(){var j=this,i=j.get("demos"),k=[];h.each(i,function(l){if(!l.get("rendered")){k.push(l)}});return k},_renderDemos:function(j){var i=this;h.each(j,function(l){if(!l.get("rendered")){var k=l.get("srcNode");if(h.isInVerticalView(k.offset().top)){l.render();l.fetchSource()}}})},_initNavMenu:function(){var i=this,k=$("h2,h3"),j=[];k.each(function(m,p){var o=$(p),q=o.attr("id"),n=o.is("h2")?"h2":"h3";if(!q){q="h"+m;o.attr("id",q)}j.push({id:q,href:"#"+q,text:o.text(),type:n})});var l=new g.Menu({render:"body",elCls:"nav-menu",itemTpl:'<a class="{type}" href="{href}">{text}</a>',children:j});l.render();i.set("menu",l)},_initLinks:function(){var i=this,j=new c();j.init();i.set("link",j)},_initPretty:function(i){var j=$("pre");h.each(j,function(m){var o=$(m),l=o.children("textarea"),p;o.addClass(a);if(l.length){p=l.html()}else{p=o.html()}var k=/^(\s+)/.exec(p),n;if(k){n=new RegExp("("+k[0]+")(\\s*)","ig");p=p.replace(n,"$2")}o.html(p)});if(window.prettyPrint){prettyPrint()}},_initEvent:function(){var i=this;$(window).on("unload",function(){i.destroy()});function j(){var k=i._getUnloadDemos();if(!k.length){$(window).off("scroll",j)}else{i._renderDemos(k)}}$(window).on("scroll",j)},destroy:function(){var j=this,i=j.get("demos"),l=j.get("menu"),k=j.get("apis");h.each(i,function(m){m.destroy()});h.each(k,function(m){m.destroy()});l.destroy();j.clearAttrVals()}});return e});
